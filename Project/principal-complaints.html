<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Complaints - Principal</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar" style="background: linear-gradient(180deg, #8e44ad 0%, #2c3e50 100%);">
            <div class="logo-section">
                <i class="fas fa-building fa-2x"></i>
                <h3>Admin Panel</h3>
            </div>
            <ul class="menu">
                <li><a href="principal-dashboard.html"><i class="fas fa-chart-pie"></i> Overview</a></li>
                <li><a href="principal-staff.html"><i class="fas fa-chalkboard-teacher"></i> Manage Staff</a></li>
                <li><a href="principal-students.html"><i class="fas fa-user-graduate"></i> Manage Students</a></li>
                <li><a href="principal-notice.html"><i class="fas fa-bullhorn"></i> Publish Notice</a></li>
                <li><a href="principal-complaints.html" class="active"><i class="fas fa-exclamation-circle"></i> Complaints</a></li>
                <li><a href="principal-accounts.html"><i class="fas fa-money-bill-wave"></i> Accounts</a></li>
            </ul>
            <div class="logout-section">
                <a href="login.html" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>

        <div class="main-content">
            <header>
                <div class="welcome-text">
                    <h2>Student Grievances</h2>
                    <p>Review and Resolve Issues</p>
                </div>
                <div class="user-profile">
                     <img src="https://ui-avatars.com/api/?name=Principal&background=8e44ad&color=fff" alt="User">
                </div>
            </header>

            <div class="profile-wrapper">
                <h3>All Complaints</h3>
                <br>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Type</th>
                            <th>Issue Description</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="complaintBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            loadAllComplaints();
        };

        function loadAllComplaints() {
            const tbody = document.getElementById('complaintBody');
            tbody.innerHTML = "";
            const complaints = JSON.parse(localStorage.getItem('ggtu_complaints')) || [];

            if(complaints.length === 0) {
                tbody.innerHTML = "<tr><td colspan='5' style='text-align:center;'>No pending complaints. Good Job!</td></tr>";
                return;
            }

            complaints.forEach((c, index) => {
                let statusBadge = c.status === 'Pending' 
                    ? `<span class="badge-grade bg-orange">Pending</span>` 
                    : `<span class="badge-grade bg-green">Resolved</span>`;
                
                let actionBtn = c.status === 'Pending'
                    ? `<button onclick="resolveIssue(${index})" style="background:#28a745; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">Mark Resolved</button>`
                    : `<span style="color:green;"><i class="fas fa-check-double"></i> Done</span>`;

                let row = `
                    <tr>
                        <td><b>${c.studentName}</b><br><small>${c.studentId}</small></td>
                        <td>${c.type}</td>
                        <td><b>${c.subject}</b><br><span style="color:#666; font-size:13px;">${c.desc}</span></td>
                        <td>${statusBadge}</td>
                        <td>${actionBtn}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function resolveIssue(index) {
            let complaints = JSON.parse(localStorage.getItem('ggtu_complaints'));
            complaints[index].status = "Resolved";
            localStorage.setItem('ggtu_complaints', JSON.stringify(complaints));
            
            alert("âœ… Complaint Marked as Resolved!");
            loadAllComplaints();
        }
    </script>
</body>
</html>